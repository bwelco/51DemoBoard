C51 COMPILER V9.00   MAIN                                                                  01/16/2016 00:00:21 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <myhead.h>
   2          
   3          // int T  温度
   4          // int R 湿度  使用gettemperature();后可以打印出温湿度的值
   5          int recv_lock = 0;
   6          unsigned char flag1 = 0,flag2 = 0,temp1,temp2;
   7          char strbuf[50] = {0};
   8          int posi = 0;
   9          int temp_lock = 0;
  10          int card_id_posi = 0;
  11          char cardid[20] = {0};
  12          char cardid_temp[20];
  13          
  14          char tab1[20];
  15          char tab2[20];
  16          
  17          int temp_max = 100;
  18          int temp_min = -40;
  19          int light_max = 99999;
  20          int light_min = -1;
  21          int humi_max = 100;
  22          int humi_min = 0;
  23          
  24          int temp_max_flag = 0;
  25          int temp_min_flag = 0;
  26          
  27          int light_max_flag = 0;
  28          int light_min_flag = 0;
  29          
  30          int humi_max_flag = 0;
  31          int humi_min_flag = 0;
  32          
  33          int redlight_flag = 0;
  34          int sound_flag = 0;
  35          
  36          int steer_flag = 0;
  37          int card_flag = 0;
  38          char led_set[4];
  39          char setcard_buf[20];
  40          int steer_degree = 0;
  41          
  42          int lock_2 = 0;
  43          int lock_3 = 0;
  44          int card_flag_c = 0;
  45          int delay_flag = 0;
  46          int testflag = 0;
  47          int main()
  48          {       
  49   1              bpm = 0;
  50   1          system_init();      
  51   1              sendstr("Programme starting...\n");
  52   1              
  53   1              while(1)
  54   1              {               
  55   2                      while(recv_lock != 1)
C51 COMPILER V9.00   MAIN                                                                  01/16/2016 00:00:21 PAGE 2   

  56   2                      {
  57   3                              if(redlight_flag == 1)
  58   3                              {
  59   4                                      if(redlight == 1)
  60   4                                          bpm = 1;
  61   4                                      else
  62   4                                              bpm = 0;
  63   4                              }
  64   3                              if(mykey == 0)
  65   3                              {
  66   4                                      //sound_delay();
  67   4                                      if(mykey == 0)
  68   4                                      {
  69   5                                              while(lock_2 == 1);
  70   5                                              lock_3 = 1;
  71   5                                              
  72   5                                              bpm = 1;
  73   5                                              stop_interrupt();
  74   5                                              pwm_value = turn(90);
  75   5                                              InitSteering();
  76   5                                              interrupt1_lock = 1;
  77   5                                              interrupt3_lock = 1;
  78   5                                              
  79   5                                              delay_ms_steering(1000);
  80   5                                              delay_ms_steering(1000);
  81   5                                              delay_ms_steering(500);
  82   5                                              StopSteering();
  83   5                                              start_interrupt();
  84   5                                              sendstr("OK\n");
  85   5                                              interrupt1_lock = 0;
  86   5                                              interrupt3_lock = 0;
  87   5                                              bpm = 0;
  88   5                                              
  89   5                                              lock_3 = 0;
  90   5                                      }
  91   4                              }
  92   3                              if(sound_key == 0 && sound_flag == 1)
  93   3                              {                                       
  94   4                                              if(testflag == 0)
  95   4                                              {
  96   5                                                      out3 = 0;
  97   5                                                  sprintf(send_message, "out3 = 0\n");
  98   5                                                  sendstr(send_message);
  99   5                                                      testflag = 1;
 100   5      
 101   5                                                      delay_ms_steering(1000);
 102   5                                                      delay_ms_steering(1000);
 103   5                                                      delay_ms_steering(500);
 104   5                                              }
 105   4                                              else if(testflag == 1)
 106   4                                              {
 107   5                                                      out3 = 1;
 108   5                                                  sprintf(send_message, "out3 = 1\n");
 109   5                                                  sendstr(send_message);
 110   5                                                      testflag = 0;
 111   5      
 112   5                                                      delay_ms_steering(1000);
 113   5                                                      delay_ms_steering(1000);
 114   5                                                      delay_ms_steering(500);
 115   5                                              }                               
 116   4                  }
 117   3                              
C51 COMPILER V9.00   MAIN                                                                  01/16/2016 00:00:21 PAGE 3   

 118   3                              if(temp_min_flag == 1 && temp_min > (int)TH)
 119   3                              {
 120   4                                      out1 = 0;
 121   4                                      sprintf(send_message, "out1 = 0\n");    //温度 < 下线值  输出1开
 122   4                                      sendstr(send_message);
 123   4                              }
 124   3                              
 125   3                              
 126   3                              if(temp_max_flag == 1 && (int)TH > temp_max)
 127   3                              {
 128   4                                      out1 = 1;
 129   4                                      sprintf(send_message, "out1 = 1\n");    //温度 > 上限值  输出1关
 130   4                                      sendstr(send_message);
 131   4                              }
 132   3                              
 133   3                              if(humi_max_flag == 1 && (int)RH > humi_max)
 134   3                              {
 135   4                                      out2 = 0;
 136   4                                      sprintf(send_message, "out2 = 1\n");    //湿度 > 上限值  输出2关
 137   4                                      sendstr(send_message);
 138   4                              }
 139   3                              
 140   3                              if(humi_min_flag == 1 && (int)RH < humi_min)
 141   3                              {
 142   4                                      out2 = 1;
 143   4                                      sprintf(send_message, "out2 = 0\n");    //湿度 < 下限值  输出2开
 144   4                                      sendstr(send_message);
 145   4                              }
 146   3                              
 147   3                              if(light_min_flag == 1 && light_compare < light_min)
 148   3                              {
 149   4                                      out3 = 0;
 150   4                                      sprintf(send_message, "out3 = 0\n");    //光照 < 下限值  输出3开
 151   4                                      sendstr(send_message);
 152   4                                      
 153   4                                      red = led_set[0] - '0';
 154   4                              green = led_set[1]- '0';
 155   4                              blue = led_set[2] - '0';                
 156   4                              }
 157   3                              
 158   3                              if(light_max_flag == 1 && light_compare > light_max)
 159   3                              {
 160   4                                      out3 = 1;
 161   4                                      sprintf(send_message, "out3 = 1\n");    //光照 > 上限值  输出3关
 162   4                                      sendstr(send_message);
 163   4                                      
 164   4                                      red = 1;
 165   4                              green = 1;
 166   4                              blue = 1;       
 167   4                              }
 168   3                              
 169   3                              if(flag2 == 1)
 170   3                              {
 171   4                                      if(android_flag == 1)
 172   4                                      {
 173   5                                              sprintf(send_message, "card id = %s\n", cardid);
 174   5                                              sendstr(send_message);
 175   5                                      }
 176   4                                      if(strcmp(cardid, setcard_buf) != 0)
 177   4                                      {
 178   5                                              continue;
 179   5                                      }
C51 COMPILER V9.00   MAIN                                                                  01/16/2016 00:00:21 PAGE 4   

 180   4                                      if(steer_flag == 1 && card_flag == 1 && 
 181   4                                              (strcmp(cardid, setcard_buf) == 0))
 182   4                                      {
 183   5                                              while(lock_2 == 1);
 184   5                                              lock_3 = 1;
 185   5                                              
 186   5                                              bpm = 1;
 187   5                                              stop_interrupt();
 188   5                                              pwm_value = turn(steer_degree);
 189   5                                              InitSteering();
 190   5                                              interrupt1_lock = 1;
 191   5                                              interrupt3_lock = 1;
 192   5                                              
 193   5                                              delay_ms_steering(1000);
 194   5                                              delay_ms_steering(1000);
 195   5                                              delay_ms_steering(500);
 196   5                                              StopSteering();
 197   5                                              start_interrupt();
 198   5                                              sendstr("OK\n");
 199   5                                              interrupt1_lock = 0;
 200   5                                              interrupt3_lock = 0;
 201   5                                              bpm = 0;
 202   5                                              
 203   5                                              lock_3 = 0;
 204   5                                              
 205   5                      }
 206   4                                      stop_interrupt();
 207   4                              //      Delay500ms();
 208   4                                      //Delay500ms();
 209   4                                      
 210   4                                      while(S2CON&S2RI)
 211   4                                      {
 212   5                                              S2CON&=~S2RI;
 213   5                                              temp2=S2BUF;
 214   5                                      }
 215   4                                      flag2 = 0;
 216   4                                      start_interrupt();
 217   4                                      
 218   4                              }
 219   3              }
 220   2                      handle_message();
 221   2                      recv_lock = 0;
 222   2                      
 223   2              }
 224   1      }
 225          
 226          void sound_delay(unsigned int z)
 227          {                                                                                                                                                                                          
 228   1          unsigned int i,j;
 229   1          for(i=z;i>0;i--)
 230   1              for(j=110;j>0;j--);
 231   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1119    ----
   CONSTANT SIZE    =    101    ----
   XDATA SIZE       =    210    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.00   MAIN                                                                  01/16/2016 00:00:21 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
